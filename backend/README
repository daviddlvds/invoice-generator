# Invoice Generator â€“ Backend

Backend desarrollado como parte de una **prueba tÃ©cnica Full Stack Senior**, enfocado en **reglas de negocio**, **arquitectura limpia** y **generaciÃ³n de PDFs server-side**.

El objetivo principal es procesar facturas con reglas especÃ­ficas segÃºn el tipo de Ã­tems (`PRODUCT` o `SERVICE`), generar un preview con totales correctos y permitir la descarga de un PDF generado desde plantillas HTML.

---

## Decisiones tÃ©cnicas clave

* **Node.js + Express + TypeScript**
* **Arquitectura por capas** (DTOs, Domain, Services, Controllers, Infrastructure)
* **GeneraciÃ³n de PDF server-side** usando:

  * HTML + Handlebars (plantillas reutilizables)
  * `wkhtmltopdf` (herramienta usada en entornos reales)
* **SeparaciÃ³n total entre lÃ³gica de negocio y capa HTTP**

---

## ðŸ“ Estructura del proyecto

```
src/
â”œâ”€ controllers/        # Controladores HTTP (Express)
â”œâ”€ domain/             # Reglas de negocio
â”‚  â””â”€ validators/
â”œâ”€ dtos/               # Contratos de entrada/salida
â”œâ”€ infrastructure/
â”‚  â””â”€ pdf/             # GeneraciÃ³n de PDFs (HTML + wkhtmltopdf)
â”‚     â”œâ”€ templates/
â”‚     â”‚  â”œâ”€ invoices/
â”‚     â”‚  â””â”€ partials/
â”œâ”€ middlewares/        # Manejo centralizado de errores y polÃ­ticas CORS
â”œâ”€ repositories/
â”‚  â””â”€ inmemory/        # Persistencia temporal
â”œâ”€ routes/             # DefiniciÃ³n de rutas
â”œâ”€ services/           # OrquestaciÃ³n de casos de uso
â”œâ”€ app.ts              # ConfiguraciÃ³n de Express
â””â”€ server.ts           # Entry point
```

---

## Reglas de negocio implementadas

* Una factura **NO puede mezclar** Ã­tems de tipo `PRODUCT` y `SERVICE`.
* CÃ¡lculo de totales:

  * **SERVICE** â†’ el descuento se aplica **antes** de impuestos.
  * **PRODUCT** â†’ el descuento se aplica **despuÃ©s** de impuestos.
* ValidaciÃ³n backend obligatoria (no dependiente del frontend).

---

## Endpoints disponibles

### â–¶ï¸ Preview de factura

`POST /api/invoices/preview`

Calcula y devuelve los totales de la factura.

**Body (ejemplo):**

```json
{
  "company": {
    "name": "",
    "contactName": "",
    "website": "",
    "address": "",
    "zip": "",
    "country": "",
    "email": ""
  },
  "client": {
    "name": "",
    "address": "",
    "cityStateZip": "",
    "country": "",
    "email": ""
  },
  "meta": {
    "invoiceNumber": "INV-001",
    "invoiceDate": "2026-02-08",
    "dueDate": "2026-02-08"
  },
  "notes": "",
  "items": [
    {
      "type": "SERVICE",
      "description": "Item 1",
      "quantity": 3,
      "unitPrice": 543,
      "discount": 0,
      "taxRate": 0.16
    }
  ]
}

```

---

### â–¶ï¸ Generar PDF

`POST /api/invoices/pdf`

Genera y devuelve un PDF basado en una plantilla HTML.

```bash
curl -X POST http://localhost:3001/api/invoices/pdf \
  -H "Content-Type: application/json" \
  -d '{...}' --output invoice.pdf
```

---

## GeneraciÃ³n de PDFs

* Plantillas HTML con Handlebars
* Uso de **partials globales** (`header`, `footer`) para layout compartido
* Helpers personalizados (`formatCurrency`, `formatDate`, etc.)
* El PDF se genera **server-side**, sin depender del frontend

---

## Requisitos

* Node.js >= 18
* wkhtmltopdf instalado en el sistema

### macOS

```bash
brew install wkhtmltopdf
```

---

## Ejecutar el proyecto

```bash
npm install
npm run dev
```

Servidor disponible en:

```
http://localhost:3001
```


---

## Autor

David Delgado
Prueba tÃ©cnica â€“ Full Stack Senior Developer
